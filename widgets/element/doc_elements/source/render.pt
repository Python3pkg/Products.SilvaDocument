<metal:block use-macro="container/macro_normal_view/macros/normal_view">
  <metal:block fill-slot="node_content"
    tal:define="source here/get_source | nothing;"
    >
    <tal:block tal:condition="not:source">
      <div class="warning"><b>[external source element is broken]</b>
    </tal:block>
    <tal:block tal:condition="source">
      <div>
        <h3 class="front5">External Source settings:</h3>
        Id:&nbsp;<tal:block content="source/id" />
        <br />
        Title:&nbsp;<tal:block content="source/title" />
        <br />
        Description:
        <p 
          tal:condition="source/description"
          tal:content="source/description" />
      </div>
      <h1></h1>    
      <div
        tal:define="
          form source/form | nothing;
          fields form/get_fields | nothing;
          has_parameters python: form and fields;
          current_parameters here/get_parameters;
          "
        >
        <b tal:condition="not: has_parameters">
          No parameters to be filled for this source.
        </b>
        <table cellspacing="0" cellpadding="2" border="0"
          tal:condition="has_parameters"
          >
          <thead>
            <tr>
              <th colspan="3">
                <b>Source parameters</b>          
              </th>
            </tr>
          </thead>
          <tbody>
            <tal:block repeat="field fields">
              <tr 
                tal:define="
                  iterate repeat/field/odd;
                  id field/id;
                  title python: field['title'] or nothing;
                  description python: field['description'] or nothing;
                  is_required field/is_required | nothing;
                  current_value current_parameters/?id | nothing;
                  "
                tal:attributes="class python: iterate and 'odd' or 'even'"
                >
                <td class="align-right">
                  <span tal:replace="title">
                    title
                  </span><span class="warning" tal:condition="is_required">*</span>
                </td>
                <td tal:content="structure python: field.render_view(value=current_value)" />
                <td tal:content="description" />
              </tr>
            </tal:block>
          </tbody>
        </table>
      </div>    
    </tal:block>
  </metal:block>
</metal:block>