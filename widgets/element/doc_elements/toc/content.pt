<tal:def 
  define="
    node request/node;
    model request/ghost_model | request/model;
    toc_depth python: int(test(node.hasAttribute('toc_depth'), node.getAttribute('toc_depth'), -1));
    public options/public | nothing;
    title_method python: test(public, 'get_title', 'get_title_editable');
    tree python: here.get_tree(model=model, toc_depth=toc_depth, public=public);
    append_to_url options/append_to_url | string:/edit/tab_edit;
  "><tal:loop 
    repeat="obj tree"><tal:def 
      define="
        indent python:obj[0]; 
        item python:obj[1];
        title python:getattr(obj[1], title_method)();
        url string:${item/absolute_url}${append_to_url}"
      tal:condition="python:not (hasattr(item, 'hide_from_tocs') and item.getMetadataElement('silva-extra', 'hide_from_tocs') == 'hide')"
      >
<p tal:attributes="class string:toc level-$indent">
<a tal:attributes="href url"
  tal:content="python:title and title or item.id">
  title
</a>
</p></tal:def></tal:loop></tal:def>
